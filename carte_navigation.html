<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Centre Multisport</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            overflow: hidden;
        }
        
        .map-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background: #2a2a2a;
        }
        
        #plan-svg {
            width: 100%;
            height: 100%;
        }
        
        .salle {
            cursor: pointer;
        }
        
        .salle-accueil rect {
            fill: #28a745;
        }
        
        .salle-destination rect {
            fill: #dc3545;
        }
        
        .salle-normale rect {
            fill: #4a4a4a;
        }
        
        .couloir {
            fill: #3a3a3a;
        }
        
        .escalier {
            fill: #5a5a5a;
        }
        
        .salle-text {
            fill: white;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            pointer-events: none;
        }
        
        .couloir-text {
            fill: #cccccc;
            font-size: 14px;
            text-anchor: middle;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="map-container">
        <svg id="plan-svg" viewBox="0 0 920 460" xmlns="http://www.w3.org/2000/svg">
            <rect x="0" y="0" width="920" height="460" fill="#1a1a1a"/>
            
            <g class="salle salle-normale" data-salle="natation">
                <rect x="10" y="120" width="180" height="220"/>
                <text x="100" y="220" class="salle-text">SALLE</text>
                <text x="100" y="240" class="salle-text">NATATION</text>
            </g>
            
            <g class="escalier-zone" data-zone="escalier_2">
                <rect x="200" y="10" width="90" height="120" class="escalier"/>
                <text x="245" y="65" class="couloir-text">ESCALIER</text>
                <text x="245" y="80" class="couloir-text">2</text>
            </g>
            
            <g class="salle salle-normale" data-salle="salle_b">
                <rect x="290" y="10" width="160" height="170"/>
                <text x="370" y="95" class="salle-text">SALLE B</text>
            </g>
            
            <g class="salle salle-normale" data-salle="salle_a">
                <rect x="450" y="10" width="160" height="170"/>
                <text x="530" y="95" class="salle-text">SALLE A</text>
            </g>
            
            <g class="salle salle-accueil" data-salle="accueil">
                <rect x="610" y="10" width="200" height="170"/>
                <text x="710" y="95" class="salle-text">ACCUEIL</text>
            </g>
            
            <rect x="190" y="190" width="620" height="80" class="couloir"/>
            <text x="500" y="235" class="couloir-text">COULOIR</text>
            
            <g class="zone-entree" data-zone="entree">
                <rect x="810" y="190" width="110" height="80" fill="#2a5298"/>
                <text x="865" y="235" class="couloir-text">ENTRÉE</text>
            </g>
            
            <g class="salle salle-normale" data-salle="salle_d">
                <rect x="290" y="280" width="160" height="170"/>
                <text x="370" y="365" class="salle-text">SALLE D</text>
            </g>
            
            <g class="salle salle-normale" data-salle="salle_c">
                <rect x="450" y="280" width="160" height="170"/>
                <text x="530" y="365" class="salle-text">SALLE C</text>
            </g>
            
            <g class="escalier-zone" data-zone="escalier_1">
                <rect x="620" y="360" width="70" height="90" class="escalier"/>
                <text x="655" y="395" class="couloir-text">ESCALIER</text>
                <text x="655" y="415" class="couloir-text">1</text>
            </g>
            
            <g id="trajet-container"></g>
        </svg>
    </div>
    
    <script>
        var salles = {
            accueil:  { position: {x: 710, y: 95} },
            salle_a:  { position: {x: 530, y: 95} },
            salle_b:  { position: {x: 370, y: 95} },
            salle_c:  { position: {x: 530, y: 365} },
            salle_d:  { position: {x: 370, y: 365} },
            natation: { position: {x: 100, y: 230} }
        };

        var aliases = {
            "salle_natation": "natation",
            "salle natation": "natation",
            "piscine": "natation"
        };
    
        function getParam(name) {
            var query = window.location.search.substring(1);
            var pairs = query.split("&");
            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i].split("=");
                if (decodeURIComponent(pair[0]) === name) {
                    return decodeURIComponent(pair[1] || "");
                }
            }
            return null;
        }
    
        function normalizeDestinationKey(raw) {
            if (!raw) return null;
            raw = raw.toLowerCase().replace(/^\s+|\s+$/g, "");

            var key = raw.replace(/ /g, "_");
            if (salles[key]) return key;
            if (salles[raw]) return raw;
            if (aliases[raw]) return aliases[raw];
            if (aliases[key]) return aliases[key];

            for (var k in salles) {
                if (salles.hasOwnProperty(k)) {
                    if (raw.indexOf(k) !== -1 || k.indexOf(raw.replace(/_/g, "")) !== -1) {
                        return k;
                    }
                }
            }
            return null;
        }
    
        function naviguerVers(salle) {
            if (!salles[salle]) return;

            var elements = document.getElementsByClassName("salle");
            for (var i = 0; i < elements.length; i++) {
                elements[i].setAttribute("class", "salle salle-normale");
            }

            var accueilEl = document.querySelector('[data-salle="accueil"]');
            if (accueilEl) accueilEl.setAttribute("class", "salle salle-accueil");

            var salleEl = document.querySelector('[data-salle="' + salle + '"]');
            if (salleEl) salleEl.setAttribute("class", "salle salle-destination");

            dessinerTrajet("accueil", salle);
        }
    
        function dessinerTrajet(depart, arrivee) {
            var trajetContainer = document.getElementById("trajet-container");
            trajetContainer.innerHTML = "";
    
            var posDepart = salles[depart].position;
            var posArrivee = salles[arrivee].position;
    
            var points = [];
            points.push(posDepart);
            points.push({x: 610, y: posDepart.y});
            points.push({x: 610, y: 230});
    
            if (arrivee === "salle_a" || arrivee === "salle_b") {
                points.push({x: posArrivee.x, y: 230});
                points.push({x: posArrivee.x, y: 180});
            } else {
                points.push({x: posArrivee.x, y: 230});
                if (arrivee === "natation") {
                    points.push({x: 190, y: 230});
                    points.push({x: 190, y: posArrivee.y});
                } else {
                    points.push({x: posArrivee.x, y: 280});
                }
            }
            points.push(posArrivee);

            // ─── Dessiner segment par segment avec animation JS ───
            var SEGMENT_DURATION = 600; // ms par segment

            for (var s = 0; s < points.length - 1; s++) {
                (function(index) {
                    setTimeout(function() {
                        var line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                        line.setAttribute("x1", points[index].x);
                        line.setAttribute("y1", points[index].y);
                        line.setAttribute("x2", points[index + 1].x);
                        line.setAttribute("y2", points[index + 1].y);
                        line.setAttribute("stroke", "#00bfff");
                        line.setAttribute("stroke-width", "10");
                        line.setAttribute("stroke-linecap", "round");
                        line.setAttribute("stroke-linejoin", "round");
                        // Glow effect via un deuxième trait plus large et semi-transparent
                        var glow = document.createElementNS("http://www.w3.org/2000/svg", "line");
                        glow.setAttribute("x1", points[index].x);
                        glow.setAttribute("y1", points[index].y);
                        glow.setAttribute("x2", points[index + 1].x);
                        glow.setAttribute("y2", points[index + 1].y);
                        glow.setAttribute("stroke", "rgba(0, 191, 255, 0.3)");
                        glow.setAttribute("stroke-width", "20");
                        glow.setAttribute("stroke-linecap", "round");

                        trajetContainer.appendChild(glow);
                        trajetContainer.appendChild(line);
                    }, index * SEGMENT_DURATION);
                })(s);
            }
        }
    
        window.naviguerVers = naviguerVers;
    
        window.onload = function() {
            var destinationRaw = getParam("destination");
            var destination = normalizeDestinationKey(destinationRaw);
            if (destination) {
                naviguerVers(destination);
            }
        };
    </script>
</body>
</html>