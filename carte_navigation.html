<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Centre Multisport</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            overflow: hidden;
        }
        
        /* Conteneur de la carte */
        .map-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background: #2a2a2a;
        }
        
        #plan-svg {
            width: 100%;
            height: 100%;
        }
        
        /* Styles des salles */
        .salle {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .salle:hover rect {
            filter: brightness(1.3);
        }
        
        .salle-accueil rect {
            fill: #28a745;
        }
        
        .salle-destination rect {
            fill: #dc3545;
            animation: pulse 2s infinite;
        }
        
        .salle-normale rect {
            fill: #4a4a4a;
        }
        
        .couloir {
            fill: #3a3a3a;
        }
        
        .escalier {
            fill: #5a5a5a;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* Trajet animé */
        .trajet {
            fill: none;
            stroke: #00bfff;
            stroke-width: 10;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 2000;
            stroke-dashoffset: 2000;
            animation: drawPath 4s ease-in-out forwards;
            filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.8));
        }
        
        @keyframes drawPath {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        /* Marqueur animé */
        .marker {
            filter: drop-shadow(0 0 5px rgba(40, 167, 69, 0.8));
        }
        
        .vous-etes-ici {
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        /* Texte des salles */
        .salle-text {
            fill: white;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            pointer-events: none;
        }
        
        .couloir-text {
            fill: #cccccc;
            font-size: 14px;
            text-anchor: middle;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="map-container">
        <svg id="plan-svg" viewBox="0 0 920 460" xmlns="http://www.w3.org/2000/svg">
            <!-- Fond noir -->
            <rect x="0" y="0" width="920" height="460" fill="#1a1a1a"/>
            
            <!-- SALLE NATATION (à gauche) -->
            <g class="salle salle-normale" data-salle="natation">
                <rect x="10" y="120" width="180" height="220" class="salle-normale"/>
                <text x="100" y="220" class="salle-text">SALLE</text>
                <text x="100" y="240" class="salle-text">NATATION</text>
            </g>
            
            <!-- ESCALIER 2 (en haut à gauche) -->
            <g class="escalier-zone" data-zone="escalier_2">
                <rect x="200" y="10" width="90" height="120" class="escalier"/>
                <text x="245" y="65" class="couloir-text">ESCALIER</text>
                <text x="245" y="80" class="couloir-text">2</text>
            </g>
            
            <!-- SALLE B (en haut, à gauche du centre) -->
            <g class="salle salle-normale" data-salle="salle_b">
                <rect x="290" y="10" width="160" height="170" class="salle-normale"/>
                <text x="370" y="95" class="salle-text">SALLE B</text>
            </g>
            
            <!-- SALLE A (en haut, centre) -->
            <g class="salle salle-normale" data-salle="salle_a">
                <rect x="450" y="10" width="160" height="170" class="salle-normale"/>
                <text x="530" y="95" class="salle-text">SALLE A</text>
            </g>
            
            <!-- ACCUEIL (en haut à droite) -->
            <g class="salle salle-accueil" data-salle="accueil">
                <rect x="610" y="10" width="200" height="170" class="salle-accueil"/>
                <text x="710" y="95" class="salle-text">ACCUEIL</text>
            </g>
            
            <!-- COULOIR PRINCIPAL (horizontal) -->
            <rect x="190" y="190" width="620" height="80" class="couloir"/>
            <text x="500" y="235" class="couloir-text">COULOIR</text>
            
            <!-- ENTRÉE (à droite) -->
            <g class="zone-entree" data-zone="entree">
                <rect x="810" y="190" width="110" height="80" fill="#2a5298"/>
                <text x="865" y="235" class="couloir-text">ENTRÉE</text>
            </g>
            
            <!-- SALLE D (en bas à gauche) -->
            <g class="salle salle-normale" data-salle="salle_d">
                <rect x="290" y="280" width="160" height="170" class="salle-normale"/>
                <text x="370" y="365" class="salle-text">SALLE D</text>
            </g>
            
            <!-- SALLE C (en bas au centre) -->
            <g class="salle salle-normale" data-salle="salle_c">
                <rect x="450" y="280" width="160" height="170" class="salle-normale"/>
                <text x="530" y="365" class="salle-text">SALLE C</text>
            </g>
            
            <!-- ESCALIER 1 (en bas à droite) -->
            <g class="escalier-zone" data-zone="escalier_1">
                <rect x="620" y="360" width="70" height="90" class="escalier"/>
                <text x="655" y="395" class="couloir-text">ESCALIER</text>
                <text x="655" y="415" class="couloir-text">1</text>
            </g>
            
            <!-- Conteneur pour le trajet (sera ajouté dynamiquement) -->
            <g id="trajet-container"></g>
        </svg>
    </div>
    
    <script>
        // Base de données des salles
        var salles = {
            accueil: { position: {x: 710, y: 95} },
            salle_a: { position: {x: 530, y: 95} },
            salle_b: { position: {x: 370, y: 95} },
            salle_c: { position: {x: 530, y: 365} },
            salle_d: { position: {x: 370, y: 365} },
            natation: { position: {x: 100, y: 230} }
        };
    
        // Lecture paramètre URL compatible ancien navigateur
        function getParam(name) {
            var query = window.location.search.substring(1);
            var pairs = query.split("&");
    
            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i].split("=");
                if (decodeURIComponent(pair[0]) === name) {
                    return decodeURIComponent(pair[1] || "");
                }
            }
            return null;
        }
    
        // Normalisation simple
        function normalizeDestinationKey(raw) {
            if (!raw) return null;
    
            raw = raw.toLowerCase();
            raw = raw.replace(/ /g, "_");
    
            if (salles[raw]) {
                return raw;
            }
    
            return null;
        }
    
        function naviguerVers(salle) {
            if (!salles[salle]) {
                return;
            }
    
            // Reset classes
            var elements = document.getElementsByClassName("salle");
            for (var i = 0; i < elements.length; i++) {
                elements[i].classList.remove("salle-destination");
    
                if (elements[i].getAttribute("data-salle") !== "accueil") {
                    elements[i].classList.add("salle-normale");
                }
            }
    
            // Marquer destination
            var salleElement = document.querySelector('[data-salle="' + salle + '"]');
            if (salleElement) {
                salleElement.classList.remove("salle-normale");
                salleElement.classList.add("salle-destination");
            }
    
            dessinerTrajet("accueil", salle);
        }
    
        function dessinerTrajet(depart, arrivee) {
    
            var trajetContainer = document.getElementById("trajet-container");
            trajetContainer.innerHTML = "";
    
            var posDepart = salles[depart].position;
            var posArrivee = salles[arrivee].position;
    
            var points = [];
            points.push(posDepart);
            points.push({x: 610, y: posDepart.y});
            points.push({x: 610, y: 230});
    
            if (arrivee === "salle_a" || arrivee === "salle_b") {
                points.push({x: posArrivee.x, y: 230});
                points.push({x: posArrivee.x, y: 180});
            } else {
                points.push({x: posArrivee.x, y: 230});
    
                if (arrivee === "natation") {
                    points.push({x: 190, y: 230});
                    points.push({x: 190, y: posArrivee.y});
                } else {
                    points.push({x: posArrivee.x, y: 280});
                }
            }
    
            points.push(posArrivee);
    
            var path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            var d = "M " + points[0].x + " " + points[0].y;
    
            for (var i = 1; i < points.length; i++) {
                d += " L " + points[i].x + " " + points[i].y;
            }
    
            path.setAttribute("d", d);
            path.setAttribute("class", "trajet");
            path.setAttribute("id", "main-path");
    
            trajetContainer.appendChild(path);
        }
    
        window.naviguerVers = naviguerVers;
    
        window.onload = function() {
            var destinationRaw = getParam("destination");
            var destination = normalizeDestinationKey(destinationRaw);
    
            if (destination) {
                naviguerVers(destination);
            }
        };
    </script>
    
</body>
</html>